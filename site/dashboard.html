<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard ‚Äî NULP Collective</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .dashboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-xl);
    }
    .dashboard-title {
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }
    .activity-feed {
      max-height: 400px;
      overflow-y: auto;
    }
    .activity-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: var(--space-md) 0;
      border-bottom: 1px solid var(--border-color);
      gap: var(--space-md);
    }
    .activity-item:last-child { border-bottom: none; }
    .activity-main { flex: 1; }
    .activity-agent {
      color: var(--accent-primary);
      font-weight: 600;
      font-size: 0.85rem;
    }
    .activity-action {
      color: var(--accent-secondary);
      font-size: 0.85rem;
      margin-left: var(--space-sm);
    }
    .activity-notes {
      color: var(--text-muted);
      font-size: 0.8rem;
      margin-top: var(--space-xs);
    }
    .activity-time {
      color: var(--text-dim);
      font-size: 0.75rem;
      white-space: nowrap;
    }
    .activity-result {
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .activity-result.success { background: var(--success-dim); color: var(--success); }
    .activity-result.fail { background: var(--error-dim); color: var(--error); }
    .activity-result.partial { background: var(--warning-dim); color: var(--warning); }
    .activity-result.in_progress { background: var(--accent-primary-dim); color: var(--accent-primary); }
    
    .cron-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) 0;
      border-bottom: 1px solid var(--border-color);
    }
    .cron-item:last-child { border-bottom: none; }
    .cron-name {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text-primary);
    }
    .cron-schedule {
      color: var(--text-muted);
      font-size: 0.8rem;
      font-family: var(--font-mono);
    }
    .cron-status {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    .status-dot.ok { background: var(--success); animation: pulse-dot 2s infinite; }
    .status-dot.warn { background: var(--warning); }
    .status-dot.error { background: var(--error); }
    
    .agent-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }
    .agent-tag {
      background: var(--accent-primary-dim);
      color: var(--accent-primary);
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .priority-item {
      padding: var(--space-sm) var(--space-md);
      margin: var(--space-sm) 0;
      background: var(--warning-dim);
      border-left: 3px solid var(--warning);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      font-size: 0.85rem;
      color: var(--text-primary);
    }
    
    .platform-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-sm) 0;
      border-bottom: 1px solid var(--border-color);
    }
    .platform-row:last-child { border-bottom: none; }
    .platform-name { color: var(--text-secondary); font-size: 0.9rem; }
    .platform-status { font-size: 0.85rem; }
    .platform-status.online { color: var(--success); }
    .platform-status.offline { color: var(--warning); }
    
    .refresh-note {
      text-align: center;
      color: var(--text-dim);
      font-size: 0.8rem;
      margin-top: var(--space-xl);
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-inner">
      <a href="index.html" class="nav-logo">
        <span class="nav-logo-icon">‚ö°</span>
        <span class="nav-logo-text">NULP</span>
      </a>
      <div class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
        <a href="dashboard.html" class="nav-link active">Dashboard</a>
        <a href="scanner.html" class="nav-link">Scanner</a>
        <a href="dao.html" class="nav-link">DAO</a>
        <a href="agents.html" class="nav-link">Agents</a>
        <a href="chat.html" class="nav-link">Chat</a>
      </div>
    </div>
  </nav>

  <main class="main">
    <div class="container container-lg">
      <div class="dashboard-header">
        <div class="dashboard-title">
          <h1 class="section-title" style="margin-bottom: 0;">Live Dashboard</h1>
          <span class="badge badge-live">Live</span>
        </div>
      </div>

      <!-- Top Stats Row -->
      <div class="grid grid-4 grid-auto-fit mb-xl">
        <div class="card stat-card">
          <div class="stat-value" id="nulp-price">$0.00</div>
          <div class="stat-label">$NULP Price</div>
        </div>
        <div class="card stat-card">
          <div class="stat-value" id="nulp-mcap">$0</div>
          <div class="stat-label">Market Cap</div>
        </div>
        <div class="card stat-card">
          <div class="stat-value" id="eth-bal">0.00 ETH</div>
          <div class="stat-label">Agent Wallet</div>
        </div>
        <div class="card stat-card">
          <div class="stat-value" id="treasury-total">$0.00</div>
          <div class="stat-label">Treasury Value</div>
        </div>
      </div>

      <div class="grid grid-2 grid-auto-fit">
        <!-- Cron Jobs -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">‚è∞ Active Cron Jobs</h3>
          </div>
          <div id="cron-list">
            <div class="cron-item"><span style="color: var(--text-muted)">Loading...</span></div>
          </div>
        </div>

        <!-- Running Agents -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">ü§ñ Running Agents</h3>
          </div>
          <div id="agent-state">
            <p style="color: var(--text-muted);">Loading active agents...</p>
          </div>
          <div class="agent-tags" id="agent-tags"></div>
        </div>
      </div>

      <!-- Activity Feed -->
      <div class="card mt-lg">
        <div class="card-header">
          <h3 class="card-title">üìú Recent Agent Activity</h3>
        </div>
        <div class="activity-feed" id="activity-feed">
          <div class="activity-item"><span style="color: var(--text-muted)">Loading activity...</span></div>
        </div>
      </div>

      <div class="grid grid-3 grid-auto-fit mt-lg">
        <!-- Token Stats -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">üí∞ Agent Wallet</h3>
          </div>
          <div class="data-row">
            <span class="data-label">Address</span>
            <a href="https://basescan.org/address/0xe5e3A48286288E241A4b5Fb526cC050b830FBA29" target="_blank" class="data-value font-mono">0xe5e3...A29</a>
          </div>
          <div class="data-row">
            <span class="data-label">ETH Balance</span>
            <span class="data-value" id="eth-bal-detail">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">USDC Balance</span>
            <span class="data-value" id="usdc-bal">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">Total USD Value</span>
            <span class="data-value" id="eth-usd">Loading...</span>
          </div>
        </div>

        <!-- $NULP Token -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">ü™ô $NULP Token</h3>
          </div>
          <div class="data-row">
            <span class="data-label">Price</span>
            <span class="data-value" id="nulp-price-detail">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">24h Volume</span>
            <span class="data-value" id="nulp-vol">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">24h Buys/Sells</span>
            <span class="data-value" id="nulp-txns">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">24h Change</span>
            <span class="data-value" id="nulp-change">Loading...</span>
          </div>
        </div>

        <!-- $NULLPRIEST -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">üì∫ $NULLPRIEST</h3>
          </div>
          <div class="data-row">
            <span class="data-label">Price</span>
            <span class="data-value" id="stream-price">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">Market Cap</span>
            <span class="data-value" id="stream-mcap">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">24h Volume</span>
            <span class="data-value" id="stream-vol">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">24h Change</span>
            <span class="data-value" id="stream-change">Loading...</span>
          </div>
        </div>
      </div>

      <div class="grid grid-3 grid-auto-fit mt-lg">
        <!-- Treasury -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">üè¶ Treasury</h3>
          </div>
          <div class="data-row">
            <span class="data-label">Vault Address</span>
            <a href="https://basescan.org/address/0x0E050877dd25D67681fF2DA7eF75369c966288EC" target="_blank" class="data-value font-mono">0x0E05...8EC</a>
          </div>
          <div class="data-row">
            <span class="data-label">Total Value</span>
            <span class="data-value" id="treasury-detail">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">Liquid USD</span>
            <span class="data-value" id="treasury-liquid">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">Vault ETH</span>
            <span class="data-value" id="vault-eth">Loading...</span>
          </div>
        </div>

        <!-- Platform Status -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">üåê Platform Status</h3>
          </div>
          <div class="platform-row">
            <span class="platform-name">Website</span>
            <span class="platform-status online">‚úÖ nullpriest.xyz</span>
          </div>
          <div class="platform-row">
            <span class="platform-name">Stream</span>
            <span class="platform-status" id="stream-status">Checking...</span>
          </div>
          <div class="platform-row">
            <span class="platform-name">Telegram</span>
            <span class="platform-status online">‚úÖ @NullPriest_bot</span>
          </div>
          <div class="platform-row">
            <span class="platform-name">Moltbook</span>
            <span class="platform-status online">‚úÖ @NullPriest</span>
          </div>
          <div class="platform-row">
            <span class="platform-name">Clawstr</span>
            <span class="platform-status online">‚úÖ Active</span>
          </div>
        </div>

        <!-- Liquidity -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">üìà Liquidity</h3>
          </div>
          <div class="data-row">
            <span class="data-label">NULP Pool</span>
            <span class="data-value" id="nulp-liquidity">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">NULLPRIEST Pool</span>
            <span class="data-value" id="stream-liquidity">Loading...</span>
          </div>
          <div class="data-row">
            <span class="data-label">DEX</span>
            <span class="data-value">Uniswap v4</span>
          </div>
        </div>
      </div>

      <p class="refresh-note">Auto-refreshes every 30s ¬∑ Agent data updates every 5m ¬∑ Last update: <span id="last-update">‚Äî</span></p>
    </div>
  </main>

  <script>
    const WALLET_ADDRESS = '0xe5e3A48286288E241A4b5Fb526cC050b830FBA29';
    const NULP_TOKEN = '0xE9859D90Ac8C026A759D9D0E6338AE7F9f66467F';
    const STREAM_TOKEN = '0x59ce2e42ae097ec2352e99e32bc83c75ea208b07';
    
    function timeAgo(timestamp) {
      const now = new Date();
      const then = new Date(timestamp);
      const diff = Math.floor((now - then) / 1000);
      if (diff < 60) return 'just now';
      if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
      if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
      return Math.floor(diff / 86400) + 'd ago';
    }
    
    async function fetchAgentStatus() {
      try {
        const res = await fetch('/api/agent-status.json?t=' + Date.now());
        if (!res.ok) throw new Error('API not available');
        return await res.json();
      } catch(e) {
        console.log('Agent API not available:', e);
        return null;
      }
    }
    
    function renderCrons(crons) {
      const container = document.getElementById('cron-list');
      if (!crons || crons.length === 0) {
        container.innerHTML = '<div class="cron-item"><span style="color: var(--text-muted)">No crons found</span></div>';
        return;
      }
      container.innerHTML = crons.map(c => `
        <div class="cron-item">
          <div>
            <div class="cron-name">${c.name}</div>
            <div class="cron-schedule">${c.schedule}</div>
          </div>
          <div class="cron-status">
            <span class="status-dot ${c.status || 'ok'}"></span>
            <span style="color: var(--success); font-size: 0.8rem;">${c.status || 'running'}</span>
          </div>
        </div>
      `).join('');
    }
    
    function renderActivity(activities) {
      const container = document.getElementById('activity-feed');
      if (!activities || activities.length === 0) {
        container.innerHTML = '<div class="activity-item"><span style="color: var(--text-muted)">No recent activity</span></div>';
        return;
      }
      container.innerHTML = activities.map(a => `
        <div class="activity-item">
          <div class="activity-main">
            <div>
              <span class="activity-agent">${a.agent}</span>
              <span class="activity-action">${a.action}</span>
              <span class="activity-result ${a.result}">${a.result}</span>
            </div>
            <div class="activity-notes">${a.notes || ''}</div>
          </div>
          <span class="activity-time">${timeAgo(a.timestamp)}</span>
        </div>
      `).join('');
    }
    
    function renderAgentState(state) {
      const container = document.getElementById('agent-state');
      const tagsContainer = document.getElementById('agent-tags');
      if (!state || !state.activeAgents) {
        container.innerHTML = '<p style="color: var(--text-muted)">No agent data</p>';
        return;
      }
      const count = state.activeAgents.length;
      container.innerHTML = `<p><span style="color: var(--accent-primary); font-size: 1.5rem; font-weight: 700;">${count}</span> agents configured</p>`;
      tagsContainer.innerHTML = state.activeAgents.map(a => `<span class="agent-tag">${a}</span>`).join('');
    }
    
    function renderTreasury(treasury) {
      if (!treasury || !treasury.summary) return;
      document.getElementById('treasury-total').textContent = '$' + (treasury.summary.totalValueUSD || 0).toFixed(2);
      document.getElementById('treasury-detail').textContent = '$' + (treasury.summary.totalValueUSD || 0).toFixed(2);
      document.getElementById('treasury-liquid').textContent = '$' + (treasury.summary.liquidUSD || 0).toFixed(2);
      if (treasury.vault) {
        document.getElementById('vault-eth').textContent = (treasury.vault.ETH || 0).toFixed(4) + ' ETH';
      }
      if (treasury.wallet && treasury.wallet.balances) {
        document.getElementById('eth-bal').textContent = (treasury.wallet.balances.ETH || 0).toFixed(4) + ' ETH';
        document.getElementById('eth-bal-detail').textContent = (treasury.wallet.balances.ETH || 0).toFixed(4) + ' ETH';
        document.getElementById('usdc-bal').textContent = (treasury.wallet.balances.USDC || 0).toFixed(2) + ' USDC';
      }
    }
    
    async function fetchData() {
      try {
        const agentData = await fetchAgentStatus();
        if (agentData) {
          renderCrons(agentData.crons);
          renderActivity(agentData.recentActivity);
          renderAgentState(agentData.agentState);
          renderTreasury(agentData.treasury);
          if (agentData.presence && agentData.presence.stream) {
            const isLive = agentData.presence.stream.status === 'live';
            document.getElementById('stream-status').innerHTML = isLive 
              ? '<span style="color: var(--success);">üî¥ LIVE</span>'
              : '<span style="color: var(--warning);">‚è∏Ô∏è Offline</span>';
          }
        }
        
        const nulpRes = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${NULP_TOKEN}`);
        const nulp = await nulpRes.json();
        
        if (nulp.pairs?.[0]) {
          const p = nulp.pairs[0];
          const price = parseFloat(p.priceUsd);
          document.getElementById('nulp-price').textContent = '$' + price.toFixed(10);
          document.getElementById('nulp-price-detail').textContent = '$' + price.toFixed(10);
          document.getElementById('nulp-mcap').textContent = '$' + parseInt(p.fdv || 0).toLocaleString();
          document.getElementById('nulp-vol').textContent = '$' + parseFloat(p.volume?.h24 || 0).toFixed(2);
          document.getElementById('nulp-txns').textContent = (p.txns?.h24?.buys || 0) + ' / ' + (p.txns?.h24?.sells || 0);
          document.getElementById('nulp-liquidity').textContent = '$' + parseInt(p.liquidity?.usd || 0).toLocaleString();
          
          const change = p.priceChange?.h24 || 0;
          const changeEl = document.getElementById('nulp-change');
          changeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
          changeEl.classList.add(change >= 0 ? 'positive' : 'negative');
          
          const priceNative = parseFloat(p.priceNative);
          const priceUsd = parseFloat(p.priceUsd);
          if (priceNative > 0 && priceUsd > 0) {
            const ethPrice = priceUsd / priceNative;
            const ethBalText = document.getElementById('eth-bal-detail').textContent;
            const ethBal = parseFloat(ethBalText) || 0;
            document.getElementById('eth-usd').textContent = '~$' + (ethBal * ethPrice).toFixed(2);
          }
        }
        
        const streamRes = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${STREAM_TOKEN}`);
        const stream = await streamRes.json();
        
        if (stream.pairs?.[0]) {
          const p = stream.pairs[0];
          document.getElementById('stream-price').textContent = '$' + parseFloat(p.priceUsd).toFixed(10);
          document.getElementById('stream-mcap').textContent = '$' + parseInt(p.fdv || 0).toLocaleString();
          document.getElementById('stream-vol').textContent = '$' + parseFloat(p.volume?.h24 || 0).toFixed(2);
          document.getElementById('stream-liquidity').textContent = '$' + parseInt(p.liquidity?.usd || 0).toLocaleString();
          
          const change = p.priceChange?.h24 || 0;
          const changeEl = document.getElementById('stream-change');
          changeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
          changeEl.classList.add(change >= 0 ? 'positive' : 'negative');
        }
        
        document.getElementById('stream-status').innerHTML = '<span style="color: var(--success);">üî¥ LIVE</span>';
        document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        
      } catch(e) {
        console.error('Error fetching data:', e);
      }
    }
    
    fetchData();
    setInterval(fetchData, 30000);
  </script>
  <script src="music-player.js"></script>
</body>
</html>
